<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Clicker Challenge</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0/dist/umd/supabase.min.js"></script>
</head>
<body>
    <div id="game-container">
        <header>
            <h1>🔥 Ultimate Clicker Challenge 🔥</h1>
            <p class="subtitle">¡Sé el número uno en el ranking mundial!</p>
        </header>

        <main>
            <div id="score-panel">
                <p>👆 Tus Clicks:</p>
                <span id="click-count">0</span>
            </div>
            <button id="click-button">¡Clickea Aquí!</button>
            <div id="leaderboard">
                <h2>🏆 Ranking Mundial</h2>
                <ul id="leaderboard-list">
                    <!-- Aquí se llenará con los datos de Supabase -->
                </ul>
            </div>
        </main>

        <footer>
            <button id="login-button">Iniciar Sesión</button>
            <button id="logout-button" style="display:none;">Cerrar Sesión</button>
        </footer>
    </div>

    <script>
        // Inicializa Supabase
        const supabaseUrl = 'https://mlxuipvhcbmyfrmlsuqd.supabase.co'; // Reemplaza con tu URL de Supabase
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1seHVpcHZoY2JteWZybWxzdXFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQzNjQyNjYsImV4cCI6MjA0OTk0MDI2Nn0.BB4kCLmcKEFdx3im3eUvK-70fQG-hDQdXMp8WGU8xVQ'; // Reemplaza con tu clave pública de API
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // Variables
        let clickCount = 0;
        const clickButton = document.getElementById('click-button');
        const clickCountElement = document.getElementById('click-count');
        const leaderboardList = document.getElementById('leaderboard-list');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');

        // Maneja los clics
        clickButton.addEventListener('click', () => {
            clickCount++;
            clickCountElement.textContent = clickCount;
        });

        // Función para obtener los datos del ranking mundial
        async function getLeaderboard() {
            const { data, error } = await supabase
                .from('users')
                .select('username, click_count')
                .order('click_count', { ascending: false })
                .limit(10);

            if (error) {
                console.error('Error al obtener el ranking:', error);
                return;
            }

            leaderboardList.innerHTML = ''; // Limpiar lista antes de agregar
            data.forEach(user => {
                const listItem = document.createElement('li');
                listItem.textContent = `${user.username}: ${user.click_count} clics`;
                leaderboardList.appendChild(listItem);
            });
        }

        // Función para registrar un nuevo usuario
        async function registerUser(username, clickCount) {
            const { data, error } = await supabase
                .from('users')
                .insert([{ username, click_count: clickCount }]);

            if (error) {
                console.error('Error al registrar el usuario:', error);
                return;
            }

            console.log('Usuario registrado:', data);
            getLeaderboard();  // Actualizar el ranking
        }

        // Función de login
        loginButton.addEventListener('click', () => {
            const username = prompt('Ingresa tu nombre de usuario:');
            if (username) {
                registerUser(username, clickCount);
                loginButton.style.display = 'none';
                logoutButton.style.display = 'inline-block';
            }
        });

        // Función de logout
        logoutButton.addEventListener('click', () => {
            loginButton.style.display = 'inline-block';
            logoutButton.style.display = 'none';
        });

        // Llamada inicial para obtener el ranking
        getLeaderboard();

    </script>
</body>
</html>
